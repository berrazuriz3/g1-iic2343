----------------------------------------------------------------------------------
-- Company: 
-- Engineer: 
-- 
-- Create Date: 16.04.2023 12:25:22
-- Design Name: 
-- Module Name: ControlUnit - Behavioral
-- Project Name: 
-- Target Devices: 
-- Tool Versions: 
-- Description: 
-- 
-- Dependencies: 
-- 
-- Revision:
-- Revision 0.01 - File Created
-- Additional Comments:
-- 
----------------------------------------------------------------------------------


library IEEE;
use IEEE.STD_LOGIC_1164.ALL;

-- Uncomment the following library declaration if using
-- arithmetic functions with Signed or Unsigned values
--use IEEE.NUMERIC_STD.ALL;

-- Uncomment the following library declaration if instantiating
-- any Xilinx leaf cells in this code.
--library UNISIM;
--use UNISIM.VComponents.all;

entity ControlUnit is
    Port ( ROM_dataout : in STD_LOGIC_VECTOR (19 downto 0);
           CZN : in STD_LOGIC_VECTOR (2 downto 0);
           enableA : out STD_LOGIC;
           enableB : out STD_LOGIC;
           selA : out STD_LOGIC_VECTOR (1 downto 0);
           selB : out STD_LOGIC_VECTOR (1 downto 0);
           loadPC : out STD_LOGIC;
           selALU : out STD_LOGIC_VECTOR (2 downto 0);
           w : out STD_LOGIC);
end ControlUnit;

architecture Behavioral of ControlUnit is

begin

with ROM_dataout select
    enableA <= '1'      when "00000000000000000000",  --MOV A, B
               '0'      when "00000000000000000001", -- B,A
               '1'      when "00000000000000000010", -- A, LIT
               '0'      when "00000000000000000011", --B,LIT
               '1'      when "00000000000000000100", -- A,(Dir)
               '0'      when "00000000000000000101", -- B,(Dir)
               '0'      when "00000000000000000110", -- (Dir), A
               '0'      when "00000000000000000111", -- (Dir), B
               '1'      when "00000000000000001000",  --ADD A,B
               '0'      when "00000000000000001001", -- B,A
               '1'      when "00000000000000001010", --A,LIT
               '0'      when "00000000000000001011", --B,LIT
               '1'      when "00000000000000001100", --A,(DIR)
               '0'      when "00000000000000001101", --B,(DIR)
               '0'      when "00000000000000001110", --(DIR)
               '1'      when "00000000000000001111",  --SUB A,B
               '0'      when "00000000000000010000", --B,A
               '1'      when "00000000000000010001", --A,LIT
               '0'      when "00000000000000010010", --B,LIT
               '1'      when "00000000000000010011", --A,(DIR)
               '0'      when "00000000000000010100", --B,(DIR)
               '0'      when "00000000000000010101", --(DIR)
               '1'      when "00000000000000010110",  --AND A,B
               '0'      when "00000000000000010111", --B,A
               '1'      when "00000000000000011000", --A,LIT
               '0'      when "00000000000000011001", --B,LIT
               '1'      when "00000000000000011010", --A,(DIR)
               '0'      when "00000000000000011011", --B,(DIR)
               '0'      when "00000000000000011100", --(DIR)
               '1'      when "00000000000000011101", --OR A,B
               '0'      when "00000000000000011110", -- B,A
               '1'      when "00000000000000011111", -- A,LIT
               '0'      when "00000000000000100000", --B, LIT
               '1'      when "00000000000000100001", -- A,(DIR)
               '0'      when "00000000000000100010", --B,(DIR)
               '0'      when "00000000000000100011", --(DIR)
               '1'      when "00000000000000100100",  --XOR A,B
               '0'      when "00000000000000100101", -- B,A
               '1'      when "00000000000000100110", -- A,LIT
               '0'      when "00000000000000100111", --B,LIT
               '1'      when "00000000000000101000", --A,(DIR)
               '0'      when "00000000000000101001", --B,(DIR)
               '0'      when "00000000000000101010", --(DIR)
               '1'      when "00000000000000101011",  --NOT A
               '0'      when "00000000000000101100", -- B,A
               '0'      when "00000000000000101101", --(DIR),A
               '1'      when "00000000000000101110",  --SHL A
               '0'      when "00000000000000101111", -- B,A
               '0'      when "00000000000000110000", -- (DIR),A
               '1'      when "00000000000000110001",  --SHR A
               '0'      when "00000000000000110010", --B,A
               '0'      when "00000000000000110011", --(DIR),A
               '1'      when "00000000000000110100",  --INC A
               '0'      when "00000000000000110101", --B
               '0'      when "00000000000000110110", --(DIR)
               '1'      when "00000000000000110111",  --DEC A
               '0'      when "00000000000000111000",  --CMP A,B
               '0'      when "00000000000000111001", --A,LIT
               '0'      when "00000000000000111010", --A,(DIR)
               '0'      when others;
               
with ROM_dataout select
    enableB <= '0'      when "00000000000000000000",  --MOV
               '1'      when "00000000000000000001",
               '0'      when "00000000000000000010",
               '1'      when "00000000000000000011",
               '0'      when "00000000000000000100",
               '1'      when "00000000000000000101",
               '0'      when "00000000000000000110",
               '0'      when "00000000000000000111",
               '0'      when "00000000000000001000",  --ADD
               '1'      when "00000000000000001001",
               '0'      when "00000000000000001010",
               '1'      when "00000000000000001011",
               '0'      when "00000000000000001100",
               '1'      when "00000000000000001101",
               '0'      when "00000000000000001110",
               '0'      when "00000000000000001111",  --SUB
               '1'      when "00000000000000010000",
               '0'      when "00000000000000010001",
               '1'      when "00000000000000010010",
               '0'      when "00000000000000010011",
               '1'      when "00000000000000010100",
               '0'      when "00000000000000010101",
               '0'      when "00000000000000010110",  --AND
               '1'      when "00000000000000010111",
               '0'      when "00000000000000011000",
               '1'      when "00000000000000011001",
               '0'      when "00000000000000011010",
               '1'      when "00000000000000011011",
               '0'      when "00000000000000011100",
               '0'      when "00000000000000011101",  --OR
               '1'      when "00000000000000011110",
               '0'      when "00000000000000011111",
               '1'      when "00000000000000100000",
               '0'      when "00000000000000100001",
               '1'      when "00000000000000100010",
               '0'      when "00000000000000100011",
               '0'      when "00000000000000100100",  --XOR
               '1'      when "00000000000000100101",
               '0'      when "00000000000000100110",
               '1'      when "00000000000000100111",
               '0'      when "00000000000000101000",
               '1'      when "00000000000000101001",
               '0'      when "00000000000000101010",
               '0'      when "00000000000000101011",  --NOT
               '1'      when "00000000000000101100",
               '0'      when "00000000000000101101",
               '0'      when "00000000000000101110",  --SHL
               '1'      when "00000000000000101111",
               '0'      when "00000000000000110000",
               '0'      when "00000000000000110001",  --SHR
               '1'      when "00000000000000110010",
               '0'      when "00000000000000110011",
               '0'      when "00000000000000110100",  --INC
               '1'      when "00000000000000110101",
               '0'      when "00000000000000110110",
               '0'      when "00000000000000110111",  --DEC
               '0'      when "00000000000000111000",  --CMP
               '0'      when "00000000000000111001",
               '0'      when "00000000000000111010",
               '0'      when others;
               
with ROM_dataout select
       selA <= "00"      when "00000000000000000000",  --MOV
               "10"      when "00000000000000000001",
               "00"      when "00000000000000000010",
               "00"      when "00000000000000000011",
               "00"      when "00000000000000000100",
               "00"      when "00000000000000000101",
               "10"      when "00000000000000000110",
               "00"      when "00000000000000000111",
               "10"      when "00000000000000001000",  --ADD
               "10"      when "00000000000000001001",
               "10"      when "00000000000000001010",
               "10"      when "00000000000000001011",
               "10"      when "00000000000000001100",
               "10"      when "00000000000000001101",
               "10"      when "00000000000000001110",
               "10"      when "00000000000000001111",  --SUB
               "10"      when "00000000000000010000",
               "10"      when "00000000000000010001",
               "10"      when "00000000000000010010",
               "10"      when "00000000000000010011",
               "10"      when "00000000000000010100",
               "10"      when "00000000000000010101",
               "10"      when "00000000000000010110",  --AND
               "10"      when "00000000000000010111",
               "10"      when "00000000000000011000",
               "10"      when "00000000000000011001",
               "10"      when "00000000000000011010",
               "10"      when "00000000000000011011",
               "10"      when "00000000000000011100",
               "10"      when "00000000000000011101",  --OR
               "10"      when "00000000000000011110",
               "10"      when "00000000000000011111",
               "10"      when "00000000000000100000",
               "10"      when "00000000000000100001",
               "10"      when "00000000000000100010",
               "10"      when "00000000000000100011",
               "10"      when "00000000000000100100",  --XOR
               "10"      when "00000000000000100101",
               "10"      when "00000000000000100110",
               "10"      when "00000000000000100111",
               "10"      when "00000000000000101000",
               "10"      when "00000000000000101001",
               "10"      when "00000000000000101010",
               "10"      when "00000000000000101011",  --NOT
               "10"      when "00000000000000101100",
               "10"      when "00000000000000101101",
               "10"      when "00000000000000101110",  --SHL
               "10"      when "00000000000000101111",
               "10"      when "00000000000000110000",
               "10"      when "00000000000000110001",  --SHR
               "10"      when "00000000000000110010",
               "10"      when "00000000000000110011",
               "10"      when "00000000000000110100",  --INC
               "01"      when "00000000000000110101",
               "01"      when "00000000000000110110",
               "10"      when "00000000000000110111",  --DEC
               "10"      when "00000000000000111000",  --CMP
               "10"      when "00000000000000111001",
               "10"      when "00000000000000111010",
               "00"      when others;
               
with ROM_dataout select
       selB <= "01"      when "00000000000000000000",  --MOV
               "00"      when "00000000000000000001",
               "11"      when "00000000000000000010",
               "11"      when "00000000000000000011",
               "10"      when "00000000000000000100",
               "10"      when "00000000000000000101",
               "00"      when "00000000000000000110",
               "01"      when "00000000000000000111",
               "01"      when "00000000000000001000",  --ADD
               "01"      when "00000000000000001001",
               "11"      when "00000000000000001010",
               "11"      when "00000000000000001011",
               "10"      when "00000000000000001100",
               "10"      when "00000000000000001101",
               "01"      when "00000000000000001110",
               "01"      when "00000000000000001111",  --SUB
               "01"      when "00000000000000010000",
               "11"      when "00000000000000010001",
               "11"      when "00000000000000010010",
               "10"      when "00000000000000010011",
               "10"      when "00000000000000010100",
               "01"      when "00000000000000010101",
               "01"      when "00000000000000010110",  --AND
               "01"      when "00000000000000010111",
               "11"      when "00000000000000011000",
               "11"      when "00000000000000011001",
               "10"      when "00000000000000011010",
               "10"      when "00000000000000011011",
               "01"      when "00000000000000011100",
               "01"      when "00000000000000011101",  --OR
               "01"      when "00000000000000011110",
               "11"      when "00000000000000011111",
               "11"      when "00000000000000100000",
               "10"      when "00000000000000100001",
               "10"      when "00000000000000100010",
               "01"      when "00000000000000100011",
               "01"      when "00000000000000100100",  --XOR
               "01"      when "00000000000000100101",
               "11"      when "00000000000000100110",
               "11"      when "00000000000000100111",
               "10"      when "00000000000000101000",
               "10"      when "00000000000000101001",
               "01"      when "00000000000000101010",
               "00"      when "00000000000000101011",  --NOT
               "00"      when "00000000000000101100",
               "00"      when "00000000000000101101",
               "00"      when "00000000000000101110",  --SHL
               "00"      when "00000000000000101111",
               "00"      when "00000000000000110000",
               "00"      when "00000000000000110001",  --SHR
               "00"      when "00000000000000110010",
               "00"      when "00000000000000110011",
               "11"      when "00000000000000110100",  --INC
               "01"      when "00000000000000110101",
               "10"      when "00000000000000110110",
               "11"      when "00000000000000110111",  --DEC
               "01"      when "00000000000000111000",  --CMP
               "11"      when "00000000000000111001",
               "10"      when "00000000000000111010",
               "00"      when others;
               

with ROM_dataout select
    loadPC <=  '1'                           when "00000000000001010010",  --JMP
               CZN(1)                        when "00000000000001010011",  --JEQ
               not CZN(1)                    when "00000000000001010100",  --JNE
               '0' when others;
               

with ROM_dataout select
     selALU <= "000"      when "00000000000000000000",  --MOV
               "000"      when "00000000000000000001",
               "000"      when "00000000000000000010",
               "000"      when "00000000000000000011",
               "000"      when "00000000000000000100",
               "000"      when "00000000000000000101",
               "000"      when "00000000000000000110",
               "000"      when "00000000000000000111",
               "000"      when "00000000000000001000",  --ADD
               "000"      when "00000000000000001001",
               "000"      when "00000000000000001010",
               "000"      when "00000000000000001011",
               "000"      when "00000000000000001100",
               "000"      when "00000000000000001101",
               "000"      when "00000000000000001110",
               "001"      when "00000000000000001111",  --SUB
               "001"      when "00000000000000010000",
               "001"      when "00000000000000010001",
               "001"      when "00000000000000010010",
               "001"      when "00000000000000010011",
               "001"      when "00000000000000010100",
               "001"      when "00000000000000010101",
               "010"      when "00000000000000010110",  --AND
               "010"      when "00000000000000010111",
               "010"      when "00000000000000011000",
               "010"      when "00000000000000011001",
               "010"      when "00000000000000011010",
               "010"      when "00000000000000011011",
               "010"      when "00000000000000011100",
               "011"      when "00000000000000011101",  --OR
               "011"      when "00000000000000011110",
               "011"      when "00000000000000011111",
               "011"      when "00000000000000100000",
               "011"      when "00000000000000100001",
               "011"      when "00000000000000100010",
               "011"      when "00000000000000100011",
               "100"      when "00000000000000100100",  --XOR
               "100"      when "00000000000000100101",
               "100"      when "00000000000000100110",
               "100"      when "00000000000000100111",
               "100"      when "00000000000000101000",
               "100"      when "00000000000000101001",
               "100"      when "00000000000000101010",
               "101"      when "00000000000000101011",  --NOT
               "101"      when "00000000000000101100",
               "101"      when "00000000000000101101",
               "111"      when "00000000000000101110",  --SHL
               "111"      when "00000000000000101111",
               "111"      when "00000000000000110000",
               "110"      when "00000000000000110001",  --SHR
               "110"      when "00000000000000110010",
               "110"      when "00000000000000110011",
               "000"      when "00000000000000110100",  --INC
               "000"      when "00000000000000110101",
               "000"      when "00000000000000110110",
               "001"      when "00000000000000110111",  --DEC
               "001"      when "00000000000000111000",  --CMP
               "001"      when "00000000000000111001",
               "001"      when "00000000000000111010",
               "000"      when others;
               
with ROM_dataout select
    w       <= '0'      when others;


end Behavioral;
